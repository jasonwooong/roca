/* 
Justified Gallery
Version: 1.0.3
Author: Miro Mannino
Author URI: http://miromannino.it

Copyright 2012 Miro Mannino (miro.mannino@gmail.com)

This file is part of Justified Gallery.

This work is licensed under the Creative Commons Attribution 3.0 Unported License. 

To view a copy of this license, visit http://creativecommons.org/licenses/by/3.0/ 
or send a letter to Creative Commons, 444 Castro Street, Suite 900, Mountain View, California, 94041, USA.
*/__justifiedGallery_galleryID=0;(function(e){e.fn.justifiedGallery=function(t){function r(e,t){return'<div class="'+t+'"style="font-size: 12px; border: 1px solid red; background-color: #faa; margin: 10px 0px 10px 0px; padding: 5px 0px 5px 5px;">'+e+"</div>"}function i(t,n,r){e(t).find(".jg-loading").fadeOut(500,function(){e(this).remove();a(e,t,n,0,r)})}function s(e,t,n,r,i,s,o){var u;u='<div class="jg-image" style="left:'+i+'px">';u+=' <a href="'+e.href+'" ';o.lightbox==1?u+='rel="'+e.rel+'"':u+='target="_blank"';u+='title="'+e.title+'">';u+='  <img alt="'+e.alt+'" src="'+e.src+t+o.extension+'"';u+='style="width: '+n+"px; height: "+r+'px;">';o.captions&&(u+='  <div style="bottom:'+(r-s)+'px;" class="jg-image-label">'+e.alt+"</div>");u+=" </a></div>";return u}function o(e,t,n,r){var i,o=0,a;for(var i=0;i<e.length;i++){e[i].nh=Math.ceil(t[e[i].indx].height*((t[e[i].indx].width+n)/t[e[i].indx].width));e[i].nw=t[e[i].indx].width+n;e[i].suffix=u(e[i].nw,e[i].nh,r);e[i].l=o;r.fixedHeight||(i==0?a=e[i].nh:a>e[i].nh&&(a=e[i].nh));o+=e[i].nw+r.margins}r.fixedHeight&&(a=r.rowHeight);var f="";for(var i=0;i<e.length;i++)f+=s(t[e[i].indx],e[i].suffix,e[i].nw,e[i].nh,e[i].l,a,r);return'<div class="jg-row" style="height: '+a+"px; margin-bottom:"+r.margins+'px;">'+f+"</div>"}function u(e,t,n){var r;e>t?r=e:r=t;return r<=100?n.sizeSuffixes.lt100:r<=240?n.sizeSuffixes.lt240:r<=320?n.sizeSuffixes.lt320:r<=500?n.sizeSuffixes.lt500:r<=640?n.sizeSuffixes.lt640:n.sizeSuffixes.lt1024}function a(e,t,n,i,s){var u=new Array,a,l,c=0,h,p=e(t).width();for(l=0,a=0;l<n.length;l++){if(n[l]==null)continue;if(c+n[l].width+s.margins<=p){c+=n[l].width+s.margins;u[a]=new Array(5);u[a].indx=l;a++}else{h=Math.ceil((p-c+1)/u.length);e(t).append(o(u,n,h,s));u=new Array;u[0]=new Array(5);u[0].indx=l;a=1;c=n[l].width+s.margins}}s.justifyLastRow?h=Math.ceil((p-c+1)/u.length):h=0;e(t).append(o(u,n,h,s));if(s.lightbox)try{e(t).find(".jg-image a").colorbox({maxWidth:"80%",maxHeight:"80%",opacity:.8,transition:"elastic",current:""})}catch(d){e(t).html(r("No Colorbox founded!","jg-noColorbox"))}if(s.captions)if(s.labels)e(t).find(".jg-image-label").fadeTo(500,.7);else{e(t).find(".jg-image").mouseenter(function(t){e(t.currentTarget).find(".jg-image-label").stop();e(t.currentTarget).find(".jg-image-label").fadeTo(500,.7)});e(t).find(".jg-image").mouseleave(function(t){e(t.currentTarget).find(".jg-image-label").stop();e(t.currentTarget).find(".jg-image-label").fadeTo(500,0)})}e(t).find(".jg-resizedImageNotFound").remove();e(t).find(".jg-image img").load(function(){e(this).fadeTo(500,1)}).error(function(){e(t).prepend(r("The image can't be loaded: \""+e(this).attr("src")+'"',"jg-resizedImageNotFound"))}).each(function(){this.complete&&e(this).load()});f(e,t,n,p,s)}function f(e,t,n,r,i){var s=setInterval(function(){if(r!=e(t).width()){e(t).find(".jg-row").remove();clearInterval(s);a(e,t,n,r,i);return}},i.refreshTime)}var n=e.extend({sizeSuffixes:{lt100:"_t",lt240:"_m",lt320:"_n",lt500:"",lt640:"_z",lt1024:"_b"},usedSuffix:"lt240",justifyLastRow:!0,rowHeight:120,fixedHeight:!1,lightbox:!1,captions:!0,labels:!1,margins:1,extension:".jpg",refreshTime:500},t);return this.each(function(t,s){e(s).addClass("justifiedGallery");var o=0,u=new Array(e(s).find("img").length);__justifiedGallery_galleryID++;if(u.length==0)return;e(s).append('<div class="jg-loading"><div class="jg-loading-img"></div></div>');e(s).find("a").each(function(t,a){var f=e(a).find("img");u[t]=new Array(5);u[t].src=e(f).attr("src");u[t].alt=e(f).attr("alt");u[t].href=e(a).attr("href");u[t].title=e(a).attr("title");u[t].rel="lightbox[gallery-"+__justifiedGallery_galleryID+"]";e(a).remove();var f=new Image;e(f).load(function(){u[t]["height"]!=n.rowHeight?u[t].width=Math.ceil(this.width/(this.height/n.rowHeight)):u[t].width=this.width;u[t].height=n.rowHeight;u[t].src=u[t].src.slice(0,u[t].src.length-(n.sizeSuffixes[n.usedSuffix]+n.extension).length);++o==u.length&&i(s,u,n)});e(f).error(function(){e(s).prepend(r("The image can't be loaded: \""+u[t].src+'"',"jg-usedPrefixImageNotFound"));u[t]=null;++o==u.length&&i(s,u,n)});e(f).attr("src",u[t].src)})})}})(jQuery);